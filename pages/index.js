import Head from "next/head"
import Image from "next/image"
import { ApolloClient, InMemoryCache, gql } from "@apollo/client"

export default function Home({ launches }) {
   console.log("launches", launches)
   console.log("img", launches[0].links.mission_patch)

   return (
      <div>
         <Head>
            <title>Create Next App</title>
            <meta name="description" content="Generated by create next app" />
            <link rel="icon" href="/favicon.ico" />
         </Head>

         {launches.map((item) => {
            return (
               <h1 className="text-white" key={item.id}>
                  {item.id} {item.launch_date_local} {item.mission_name}
               </h1>
            )
         })}
         <img alt="bla" src={launches[0].links.mission_patch} />
      </div>
   )
}

export async function getStaticProps() {
   const client = new ApolloClient({
      uri: "https://api.spacex.land/graphql/",
      cache: new InMemoryCache(),
   })
   const { data } = await client.query({
      query: gql`
         query GetLaunches {
            launchesPast(limit: 10) {
               id
               mission_name
               launch_date_local
               launch_site {
                  site_name_long
               }
               links {
                  article_link
                  video_link
                  mission_patch
               }
               rocket {
                  rocket_name
               }
            }
         }
      `,
   })

   return {
      props: {
         launches: data.launchesPast,
      },
   }
}
